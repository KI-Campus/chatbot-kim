version: '3.1'

stories:

  - story: start recommender 
    steps:
    - intent: greet
    - action: utter_greet
    - action: utter_tip_formulation
    - slot_was_set:
      - search_topic: None
    - or:
      - intent: start_recommender_form
      - intent: search_topics
    - action: action_recommender_or_search_topics #
    - intent: start_recommender_form #
    - checkpoint: start_recommender_profile_check #

  - story: start search topic
    steps:
    - intent: greet
    - action: utter_greet
    - action: utter_tip_formulation
    - slot_was_set:
      - search_topic: None
    - or:
      - intent: start_recommender_form
      - intent: search_topics
      - slot_was_set: 
        - search_topic: "Machine Learning"
    - action: action_recommender_or_search_topics #
    - intent: search_topics #
    - action: action_search_topic
    - action: utter_anything_else
    - checkpoint: more_information

# # FIXME: fix paths for utter_tip_login + affirm

# # start recommender form + login check 
  # - story: check login happy + start recommender
  #   steps:
  #   - intent: start_recommender_form
  #   - action: action_delete_slot_value
  #   - slot_was_set:
  #     - user_login: true
  #   - action: utter_affirm_start_recommender_form 
  #   - intent: affirm
  #   - action: action_fetch_profile
  #   - slot_was_set:
  #     - enrollments: "Einführung in die KI"
  #     - course_visits: "Big Data Analytics"
  #     - search_terms: "KI"
  #   - checkpoint: start_recommender_form

  # - story: check login happy + no recommender
  #   steps:
  #   - intent: start_recommender_form
  #   - action: action_delete_slot_value
  #   - slot_was_set:
  #     - user_login: true
  #   - action: utter_affirm_start_recommender_form
  #   - intent: deny 
  #   - action: utter_anything_else_v2

  # - story: check login unhappy + start recommender
  #   steps:
  #   - intent: start_recommender_form
  #   - action: action_delete_slot_value
  #   - slot_was_set:
  #     - user_login: false
  #   - action: utter_tip_login
  #   - action: utter_affirm_start_recommender_form_login 
  #   - intent: affirm
  #   - checkpoint: start_recommender_form

  # - story: check login unhappy + no courseseach
  #   steps:
  #   - intent: start_recommender_form
  #   - action: action_delete_slot_value
  #   - slot_was_set:
  #     - user_login: false
  #   - action: utter_tip_login
  #   - action: utter_affirm_start_recommender_form_login 
  #   - intent: deny
  #   - action: utter_anything_else_v2

# # fetch profile information
  - story: login happy
    steps:
    - checkpoint: start_recommender_profile_check
    - action: action_delete_slot_value
    - slot_was_set:
      - user_login: true
    - action: action_fetch_profile
    - slot_was_set:
      - enrollments: "Einführung in die KI"
      - course_visits: "Big Data Analytics"
      - search_terms: "KI"
    - checkpoint: start_recommender_form

  - story: login unhappy
    steps:
    - checkpoint: start_recommender_profile_check
    - action: action_delete_slot_value
    - slot_was_set:
      - user_login: false
    - checkpoint: start_recommender_form

# # recommender form basic
  - story: activate recommender form + login happy
    steps:
    - checkpoint: start_recommender_form
    - action: recommender_form      
    - active_loop: recommender_form 

  - story: activate recommender form + login unhappy
    steps:
    - checkpoint: start_recommender_form
    - action: action_delete_slot_value
    - slot_was_set:
      - user_login: false
    - action: recommender_form      
    - active_loop: recommender_form

# # recommender form variations
  - story: faq interjection
    steps:
    - checkpoint: start_recommender_form
    - action: recommender_form
    - active_loop: recommender_form
    - slot_was_set:
      - recommender_form_active: true
    - intent: faq
    - action: utter_faq
    - action: recommender_form

  - story: out of scope interjection
    steps:
    - checkpoint: start_recommender_form
    - action: recommender_form
    - active_loop: recommender_form
    - intent: help
    - action: utter_help
    - action: recommender_form

  - story: out of scope interjection
    steps:
    - checkpoint: start_recommender_form
    - action: recommender_form
    - active_loop: recommender_form
    - intent: out_of_scope
    - action: utter_out_of_scope
    - action: recommender_form

# # stop form
  - story: stop recommender form happy
    steps:
    - checkpoint: start_recommender_form 
    - action: recommender_form    
    - active_loop: recommender_form
    - intent: stop_form
    - action: utter_ask_continue_recommender_form
    - intent: affirm
    - action: action_deactivate_loop
    - active_loop: null
    - slot_was_set:
      - requested_slot: null
    - action: utter_bot_information
    - intent: goodbye
    - action: utter_goodbye

  - story: stop recommender form happy 2
    steps:
    - checkpoint: start_recommender_form 
    - action: recommender_form    
    - active_loop: recommender_form
    - intent: stop_form
    - action: utter_ask_continue_recommender_form
    - intent: affirm
    - action: action_deactivate_loop
    - active_loop: null
    - slot_was_set:
      - requested_slot: null
    - action: utter_bot_information
    - intent: faq
    - action: utter_faq
    - action: utter_anything_else_v2

  - story: stop recommender form unhappy
    steps:
    - checkpoint: start_recommender_form 
    - action: recommender_form    
    - active_loop: recommender_form
    - intent: stop_form
    - action: utter_ask_continue_recommender_form
    - intent: deny
    - action: recommender_form

# # feedback
  - story: negative feedback reaction
    steps:
    - intent: negative_feedback 
    - action: utter_bot_apology
    - action: utter_anything_else
    - checkpoint: more_information

# # change course search parameter
  - story: get more learning recommendation
    steps:
    - intent: additional_learning_recommendation
    - action: action_additional_learning_recommendation
    - action: utter_anything_else_v2

  - story: change language learning recommendation
    steps:
    - intent: change_language_slot
    - action: action_delete_slot_value
    - action: recommender_form      
    - active_loop: recommender_form 

  - story: change topic learning recommendation
    steps:
    - intent: change_topic_slot
    - action: action_delete_slot_value
    - action: recommender_form      
    - active_loop: recommender_form 

  - story: change level learning recommendation
    steps:
    - intent: change_level_slot
    - action: action_delete_slot_value
    - action: recommender_form      
    - active_loop: recommender_form 

  - story: change max_duration learning recommendation
    steps:
    - intent: change_max_duration_slot
    - action: action_delete_slot_value
    - action: recommender_form      
    - active_loop: recommender_form 

  - story: change certificate learning recommendation
    steps:
    - intent: change_certificate_slot
    - action: action_delete_slot_value
    - action: recommender_form      
    - active_loop: recommender_form 