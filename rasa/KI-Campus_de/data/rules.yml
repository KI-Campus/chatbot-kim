version: '3.1'

rules:

  - rule: Handle insults
    steps:
    - intent: insults
    - action: utter_insults

  - rule: Ask the user to rephrase whenever they send a message with low NLU confidence ex/int
    steps:
    - intent: nlu_fallback
    - action: action_default_fallback
    - slot_was_set:
      - run_default: false
    - action: utter_ask_internal_or_external_search

  - rule: Ask the user to rephrase whenever they send a message with low NLU confidence
    steps:
    - intent: nlu_fallback
    - action: action_default_fallback
    - slot_was_set:
      - run_default: true
    - action: utter_default

  - rule: answer bot challenge
    steps:
    - intent: bot_challenge
    - action: utter_iamabot

  - rule: start achievement get_courses_form
    steps:
    - intent: get_achievements
    - action: action_get_courses_buttons
    - slot_was_set:
      - courses_available: true
    - action: utter_ask_which_course
    - action: course_form
    - active_loop: course_form

  - rule: submit course form, course not achieved
    condition:
      - active_loop: course_form
    steps:
    - action: course_form
    - active_loop: null
    - slot_was_set:
      - requested_slot: null
    - action: action_get_achievements
    - slot_was_set:
      - current_course_achieved: false
    - action: utter_anything_else

  - rule: submit course form, course achieved
    condition:
      - active_loop: course_form
    steps:
    - action: course_form
    - active_loop: null
    - slot_was_set:
      - requested_slot: null
    - action: action_get_achievements
    - slot_was_set:
      - current_course_achieved: true
    - action: utter_download_certificate
    
  - rule: activate search form from search
    steps:
    - intent: search_internal
    - action: search_form
    - active_loop: search_form

  - rule: activate search form from content type
    steps:
    - intent: specify_search_content_type
    - action: search_form
    - active_loop: search_form

  - rule: submit search form
    condition:
    # Condition that form is active.
    - active_loop: search_form
    steps:
    # Form is deactivated
    - action: search_form
    - active_loop: null
    - slot_was_set:
      - requested_slot: null
    # The actions we want to run when the form is submitted.
    - action: utter_search_form_submit
    - action: action_answer_internal_search
